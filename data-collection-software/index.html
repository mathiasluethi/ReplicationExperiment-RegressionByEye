<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Slider Example</title>

        <link rel="stylesheet" href="styles.css"/>

    </head>
    <body>

        <canvas id="myCanvas" width="300" height="525"></canvas>

        <div class="history">
            <span>m = </span>
            <span id="demo">
        </div>

        <div class="slidecontainer">
            <input type="range" min="-1.75" max="1.75" step="0.01" value="0" class="slider" id="myRange">
        </div>
        <button type="button" onclick="next()">Submit</button>



        <script type="text/javascript">

            // get these values from csv
            let line = "quadratic";
            let correctGraphSlope = -1;
            var background = new Image();
            background.src = "data/line/scatter/S0.2m-1.0.png";
            background.src = "data/P1/quad/areatrend/S0.25m-0.7.png";

            let slider = document.getElementById("myRange");
            let output = document.getElementById("demo");

            let canvas = document.getElementById("myCanvas");
            ctxb = canvas.getContext("2d");
            
            // Make sure the image is loaded first, otherwise nothing will draw.
            background.onload = function(){
                ctxb.drawImage(background,0,0,300,525);  
            }

            let x1, x2, y1, y2;
            let sliderValue;
            let history = [];
            output.innerHTML = slider.value;
            
            // Update the current slider value (each time you drag the slider handle)
            slider.oninput = function() {
                sliderValue = this.value;
                output.innerHTML = sliderValue;
                x1 = 0;
                y1 = 262.5 + 150 * this.value;
                x2 = 300
                y2 = 262.5 + -150 * this.value;
                if (line === "linear") {
                    drawLinearRegression(x1, x2, y1, y2);
                } else if (line === "quadratic") {
                    drawLine();
                }
            }

            // Store the selected slider value to an array
            function next() {
                history.push(slider.value);
                console.log(history);
                
            }

            // Canvas drawing logic
            function drawLinearRegression(x1, x2, y1, y2) {
                let ctx = canvas.getContext("2d");
                ctx.clearRect(0, 0, 300, 525);
                ctxb.drawImage(background,0,0,300,525);  
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }

            function fun1(x) {
                a = sliderValue; // the curvature
                b = correctGraphSlope; // the existing linear slope of the graph
                c = 0; // where 0 point is
                if (sliderValue >= 0) {
                quadraticFunction = (Math.pow(a*x, 2)+b*x+c);
                } else {
                quadraticFunction = -(Math.pow(a*x, 2)-b*x+c);
                }
                return quadraticFunction;
            }
            function drawLine() {
            var canvas = document.getElementById("myCanvas");
            if (null==canvas || !canvas.getContext) return;

            var axes={}, ctx=canvas.getContext("2d");
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            ctxb.drawImage(background,0,0,ctx.canvas.width,ctx.canvas.height); 
            // position of axes (in the middle of canvas)
            axes.x0 = .5 + .5*canvas.width;  // x0 pixels from left to x=0
            axes.y0 = .5 + .5*canvas.height; // y0 pixels from top to y=0
            axes.scale = 40;                 // 40 pixels from x=0 to x=1 (length of graph, scaled up)
            axes.doNegativeX = true;

            funGraph(ctx,axes,fun1,"black",2); 
            }

            function funGraph (ctx,axes,func,color,thick) {
            var xx, yy, dx=4, x0=axes.x0, y0=axes.y0, scale=axes.scale;
            var iMax = Math.round((ctx.canvas.width-x0)/dx);
            var iMin = axes.doNegativeX ? Math.round(-x0/dx) : 0;
            ctx.beginPath();
            ctx.lineWidth = thick;
            ctx.strokeStyle = color;

            for (var i=iMin;i<=iMax;i++) {
            xx = dx*i; yy = scale*func(xx/scale,2);
            if (i==iMin) ctx.moveTo(x0+xx,y0-yy);
            else         ctx.lineTo(x0+xx,y0-yy);
            }
            ctx.stroke();
            }
        </script>

    </body>
</html>
