<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Slider Example</title>

        <link rel="stylesheet" href="styles.css"/>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    </head>
    <body>

        <canvas id="myCanvas" width="300" height="525"></canvas>

        <div class="history">
            <span>m = </span>
            <span id="demo"></span>
        </div>

        <div class="slidecontainer">
            <input type="range" min="-1" max="1" step="0.01" value="0" class="slider" id="myRange">
        </div>
        <button type="button" onclick="next()">Submit</button>



        <script type="text/javascript">
            
            let slider = document.getElementById("myRange");
            let output = document.getElementById("demo");

            let canvas = document.getElementById("myCanvas");
            ctxb = canvas.getContext("2d");

            // Load in the csv file and convert it to an object
            async function loadData() {
                let data = $.get("./p1.csv").then(function(csv){
                    var lines = csv.split("\n");
                    var result = [];
                    var headers = lines[0].split(",");

                    for(var i=1; i<lines.length; i++){
                        var obj = {};
                        var currentline = lines[i].split(",");

                        for(var j=0; j<headers.length; j++){
                            obj[headers[j]] = currentline[j];
                        }

                        result.push(obj);
                    }
                    return result; 
                });
                return await data;
            }
            
            // Load images
            function loadImage(task) {
                var background = new Image();
                background.src = this.task.src;

                // Make sure the image is loaded first otherwise nothing will draw.
                background.onload = function(){
                    ctxb.drawImage(background,0,0,300,525);   
                }
            }
            
            // Setup experiment
            async function setupExperiment() {
                let d = loadData();
                let data = await d;
                let task = data[0];
                
                loadImage(task);
                return data;
                
            }
            // let task = this.data.0;
            let x1, x2, y1, y2;

            output.innerHTML = slider.value;
            setupExperiment();
            // loadImage(task);
            
            // Update the current slider value (each time you drag the slider handle)
            slider.oninput = function() {
                output.innerHTML = this.value;
                x1 = 0;
                y1 = 262.5 + 150 * this.value;
                x2 = 300
                y2 = 262.5 + -150 * this.value;
                drawLinearRegression(x1, x2, y1, y2);
            }

            // Store the selected slider value to an array
            function next() {
                history.push(slider.value);
            }

            // Canvas drawing logic
            function drawLinearRegression(x1, x2, y1, y2) {
                let ctx = canvas.getContext("2d");
                ctx.clearRect(0, 0, 300, 525);
                ctxb.drawImage(background,0,0,300,525);  
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.stroke();
            }
            
        </script>

    </body>
</html>
